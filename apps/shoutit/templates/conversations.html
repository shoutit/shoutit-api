{% extends 'base.html' %}
{% load template_filters %}
{% load i18n %}
{% block content %}
    <div class="page_content">
        <div class="left-column">

            {% if conversation_messages %}
                <div class="box-container dark-container round shadow detailed-shout">
                    <div class="box-content">
                        {% set detailed = 'True' %}
                        {% include 'shout_detailed.html' %}
                    </div>
                </div>
                <input type="text" id="conversation_messages_conversation_id" value="{{ conversation_id|base62 }}" style="display: none;">
                <div class="outer-box-header round shadow">
                    {% trans "Conversation" %}
                </div>
                <div class="box-container dark-container round shadow conversation">
                    <div class="box-content">
                        {% include "conversation_messages.html" %}
                    </div>
                </div>
            {% else %}
                <div class="box-container dark-container round shadow detailed-shout" id="conversation_shout" style="display: none;"></div>
                <div class="outer-box-header round shadow">
                    <div id="conversations_header_buttons">
                    </div>
                    {% trans "Conversations" %}
                </div>

                <div class="box-container dark-container round shadow conversations">
                    <div class="box-content">
                        {% if conversations|length %}
                            {% include "conversations_stream.html" %}
                        {% else %}
                            <div>
                                {% trans "You don't have any conversation!" %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                {# parse conversation messages after request ajaxly here#}
                <div class="box-container dark-container round shadow conversation_messages" style="display: none;">
                    <div class="box-content">
                    </div>
                </div>
            {% endif %}
        </div>

        <div class="right-column">
{#            <div class="box-container white-container round shadow public-shouts">#}
{#                <div class="box-header">#}
{#					{% trans "Public Shouts" %}#}
{#				</div>#}
{#				<div class="box-content">#}
{#				</div>#}
{#            </div>#}
			<div class="box-container white-container round shadow public-events">
				<div class="box-header">
					{% trans "Public Activities" %}
				</div>
				<div class="box-content">
				</div>
			</div>
        </div>
        <div style="clear: both;"></div>
    </div>
{% endblock %}

{% block scripts %}
	<script type='text/javascript'>
        $(document).ready(function () {
//			$('body').bind('location_available', function () {
				startLiveEventsPolling('/xhr/live_events/', '.public-events .box-content');
//			});
			$('.public-events .box-content').slimScroll({
															height: '630px',
															size: '5px',
															resumePageScroll: false
														});


{#            {% if not request.user.is_authenticated and new_ip %}#}
{#                $('body').bind('location_available', function () {#}
{#                    startLiveShoutsPolling('/xhr/shouts/livetimeline/', '.public-shouts .box-content');#}
{#                });#}
{#            {% else %}#}
{#                startLiveShoutsPolling('/xhr/shouts/livetimeline/', '.public-shouts .box-content');#}
{#            {% endif %}#}
//            startLiveShoutsPolling('/xhr/shouts/livetimeline/', '.public-shouts .box-content');

            $('.conversations .box-content').scrollableStream('560px', true, '/xhr/messages/stream/', '.conversations .box-content');
            $('.conversation_messages .box-content').slimScroll({
				height: '400px',
				size: '5px',
				resumePageScroll: true
			});

//            $('.public-shouts .box-content').slimScroll({
//                height: '430px',
//                size: '5px',
//                resumePageScroll: false
//            });


            if ($('#conversation_messages_conversation_id').length != 0)
                current_conversation_id = $('#conversation_messages_conversation_id').val()
        });
    </script>
{% endblock %}
